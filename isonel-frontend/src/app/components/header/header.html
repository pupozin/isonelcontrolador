<header class="header-page" [class.shifted]="menuAberto">
  <div class="menu-toggle" (click)="toggleMenu()">
    <i class="fa-solid fa-bars"></i>
  </div>

  <a class="logo" routerLink="/">
    <img class="logo-img" src="/images/logoisonelbranco.png" alt="Isonel_logo">
  </a>

 <div class="search-bar">
  <input
    type="text"
    class="search-bar__input"
    placeholder="Pesquisar processo"
    aria-label="Pesquisar processo"
    [(ngModel)]="termoBusca"
    (keyup.enter)="buscarGlobal()"
  />
  <i class="fa-solid fa-magnifying-glass search-bar__icon" aria-hidden="true"></i>
</div>

<!-- Modal de busca -->
<div class="modal-overlay" *ngIf="modalBuscaAberto" (click)="fecharModalBusca()">
  <div class="modal-busca" (click)="$event.stopPropagation()">
    <h2>Resultados da busca</h2>

    <div *ngIf="carregandoBusca" class="loading">
      <p>Buscando...</p>
    </div>

    <div *ngIf="!carregandoBusca && resultadosBusca.length === 0">
      <p>Nenhum processo encontrado.</p>
    </div>

    <div class="resultados-container">
      <div *ngFor="let p of resultadosBusca" class="card-processo" (click)="abrirDetalhes(p)">
        <h4>{{ p.codigo }}</h4>
        <p><i class="fa-solid fa-user"></i> {{ p.cliente }}</p>
        <p><i class="fa-solid fa-box"></i> {{ p.produto }}</p>
        <p><i class="fa-solid fa-user-gear"></i> {{ p.responsavel }}</p>
        <p><i class="fa-solid fa-layer-group"></i> {{ p.estadoAtual }}</p>
        <span class="status">{{ p.statusAtual }}</span>
      </div>
    </div>
  </div>
</div>


  <div class="btn-create-process">
  <button class="btn" (click)="abrirModalCriar()">Criar processo</button>
</div>
</header>

<nav class="sidebar" [class.open]="menuAberto">
  <ul>
    <li><a routerLink="/andamento" (click)="closeMenu()">Em andamento</a></li>
    <li><a routerLink="/finalizado" (click)="closeMenu()">Finalizado</a></li>
    <li><a routerLink="/pausado" (click)="closeMenu()">Pausado</a></li>
    <li><a routerLink="/dados" (click)="closeMenu()">Dados</a></li>
  </ul>
</nav>

<div class="overlay" [class.show]="menuAberto" (click)="closeMenu()"></div>

<!-- Modal: Criar Processo -->
<div class="modal-overlay" *ngIf="modalCriarAberto" (click)="fecharModalCriar()">
  <div class="modal-criar" (click)="$event.stopPropagation()">
    <h2>Criar novo processo</h2>

    <label>Etapa inicial</label>
    <select [(ngModel)]="novoProcesso.etapa">
      <option *ngFor="let e of etapas" [value]="e">{{ e }}</option>
    </select>

    <label>Cliente</label>
    <input type="text" [(ngModel)]="novoProcesso.cliente" placeholder="Nome do cliente" />

    <label>Responsável Etapa</label>
    <input type="text" [(ngModel)]="novoProcesso.responsavel" placeholder="Nome do resposável pela etapa" />

    <label>Produto</label>
    <input type="text" [(ngModel)]="novoProcesso.produto" placeholder="Produto" />

    <label>Observação</label>
    <textarea [(ngModel)]="novoProcesso.observacao" placeholder="Digite aqui..."></textarea>

    <div class="modal-actions">
      <button class="btn-cancelar" (click)="fecharModalCriar()">Cancelar</button>
      <button class="btn-concluir" (click)="criarProcesso()">Criar</button>
    </div>
  </div>
</div>

<!-- Toast de feedback -->
<div
  class="toast"
  *ngIf="toast.visivel"
  [ngClass]="toast.tipo"
>
  <div class="toast-content">
    <i
      class="fa-solid"
      [ngClass]="{
        'fa-check-circle': toast.tipo === 'sucesso',
        'fa-times-circle': toast.tipo === 'erro'
      }"
    ></i>
    <span>{{ toast.mensagem }}</span>
  </div>
  <div class="toast-bar"></div>
</div>
